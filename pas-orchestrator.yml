---
# file: pas-orchestrator.yml
- hosts: all
  strategy: free
  
  # vars:
  #   ansible_become: yes
  #   ansible_become_method: runas
  #   ansible_become_user: "{{ ansible_user }}"
  #   ansible_become_flags: logon_type=new_credentials logon_flags=netcredentials_only

  vars_prompt:
    - name: version
      prompt: "Please enter the PAS version"
      private: no
      
    - name: vault_ip
      prompt: "Please enter the Vault ip address"
      private: no
    
    - name: vault_password
      prompt: "Please enter the Vault Administrator password"
      private: yes
      
    - name: ansible_user
      prompt: "Please enter the Hosts Administrator username"
      private: no
      
    - name: ansible_password
      prompt: "Please enter the Hosts Administrator password"
      private: yes
      
    - name: cpm_zip_file_path
      prompt: "Please enter cpm package location (etc. /tmp/pas_packages/cpm.zip)"
      private: no
      
    - name: pvwa_zip_file_path
      prompt: "Please enter pvwa package location (etc. /tmp/pas_packages/pvwa.zip)"
      private: no
      
    - name: psm_zip_file_path
      prompt: "Please enter psm package location (etc. /tmp/pas_packages/psm.zip)"
      private: no

  tasks:
  
    - set_fact:
        components_registration_order: 
          # - cpm
          - pvwa
          # - psm
      when: version == "v10.6"
      
    - set_fact:
        components_registration_order: 
          - pvwa
          - cpm
          - psm
      when: version != "v10.6"
    
    - include: pvwa.yml
      when: "'pvwa' in group_names"
    - include: cpm.yml
      when: "'cpm' in group_names"
    - include: psm.yml
      when: "'psm' in group_names"
    # - import_playbook: register_components.yml
